<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Creating and evolving a Community · CellBasedModels.jl</title><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.0/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.0/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.0/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="assets/documenter.js"></script><script src="siteinfo.js"></script><script src="../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="index.html"><img src="assets/logo.png" alt="CellBasedModels.jl logo"/></a><div class="docs-package-name"><span class="docs-autofit">CellBasedModels.jl</span></div><form class="docs-search" action="search.html"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="index.html">Home</a></li><li><span class="tocitem">Usage</span><ul><li><a class="tocitem" href="Usage_intro.html">Introduction</a></li><li><a class="tocitem" href="Usage_Agent.html">Defining an ABM model</a></li><li class="is-active"><a class="tocitem" href="Usage_Community.html">Creating and evolving a Community</a><ul class="internal"><li><a class="tocitem" href="#KwArgs-of-the-Community-constructor"><span>KwArgs of the Community constructor</span></a></li><li><a class="tocitem" href="#Accessing-and-manipulating-a-Community"><span>Accessing and manipulating a Community</span></a></li><li><a class="tocitem" href="#IO"><span>IO</span></a></li><li class="toplevel"><a class="tocitem" href="#Evolving-the-community"><span>Evolving the community</span></a></li></ul></li><li><a class="tocitem" href="Usage_Fitting.html">Model Fitting</a></li></ul></li><li><span class="tocitem">Examples</span><ul><li><a class="tocitem" href="Patterning.html">Patterning</a></li><li><a class="tocitem" href="Development.html">ICM Development</a></li><li><a class="tocitem" href="Aggregation.html">Particle aggregation</a></li><li><a class="tocitem" href="Bacteries.html">Bacterial Colony Growth</a></li><li><a class="tocitem" href="Chemotaxis.html">Bacterial chemotaxis</a></li></ul></li><li><a class="tocitem" href="Models.html">Models</a></li><li><a class="tocitem" href="API.html"><strong>API</strong></a></li><li><a class="tocitem" href="APIdevelopers.html">API for Developers</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Usage</a></li><li class="is-active"><a href="Usage_Community.html">Creating and evolving a Community</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href="Usage_Community.html">Creating and evolving a Community</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/dsb-lab/CellBasedModels.jl/blob/master/docs/src/Usage_Community.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><pre><code class="language-julia">using CellBasedModels</code></pre><h1 id="Creating-and-evolving-a-Community"><a class="docs-heading-anchor" href="#Creating-and-evolving-a-Community">Creating and evolving a Community</a><a id="Creating-and-evolving-a-Community-1"></a><a class="docs-heading-anchor-permalink" href="#Creating-and-evolving-a-Community" title="Permalink"></a></h1><p>The <code>Community</code> structure contains the realization of an agent model. This structure will store the parameters of the agent and will be prepared to be evolved by the update rules defined.</p><p>Let&#39;s use for reference the <a href="https://en.wikipedia.org/wiki/Ornstein%E2%80%93Uhlenbeck_process">Ornstein–Uhlenbeck</a> process.</p><pre><code class="language-julia">model = ABM(2,
    model = Dict(
        :σ =&gt; Float64, #Diffussion constant
        :theta =&gt; Float64  #Drifft force
    ),
    agentODE = quote
        dt(x) = -theta*x
        dt(y) = -theta*y
    end,
    agentSDE = quote
        dt(x) = σ
        dt(y) = σ
    end,
    agentAlg = DifferentialEquations.EM(), #Let&#39;s use an algorithm from DifferentialEquations suite
)</code></pre><pre><code class="language-none">PARAMETERS
	x (Float64 agent)
	y (Float64 agent)
	σ (Float64 model)
	theta (Float64 model)


UPDATE RULES
agentSDE
 begin






    dt__x = σ
    dt__y = σ
end

agentODE
 begin
    dt__x = -theta * x
    dt__y = -theta * y
end</code></pre><p>To create an initial community we just need to call a Community structure with an <code>ABM</code> model. </p><pre><code class="language-julia">com = Community(model,
                dt=0.1,
                )</code></pre><pre><code class="language-none">Community with 1 agents.</code></pre><h2 id="KwArgs-of-the-Community-constructor"><a class="docs-heading-anchor" href="#KwArgs-of-the-Community-constructor">KwArgs of the Community constructor</a><a id="KwArgs-of-the-Community-constructor-1"></a><a class="docs-heading-anchor-permalink" href="#KwArgs-of-the-Community-constructor" title="Permalink"></a></h2><p>In addition to the model structure, we can provide the Community structure with keyword arguments. You can see all pf them in the API - Community documentation. Among them you will find:</p><ul><li>Base parameters like the time <code>dt</code> or the simulation box <code>simBox</code>.</li><li>User parameters.</li></ul><p>For example, we can define a community with more agents <code>N</code>, a <code>simulationBox</code> and random positions (<code>x</code>,<code>y</code>) in the unit box by constructing the Community as</p><pre><code class="language-julia">N = 10
com = Community(model,
        N=N,
        simBox=[0 1;0 1.],
        dt = 0.1,
        x=Vector(1.:N),
        y=rand(N)
    )</code></pre><pre><code class="language-none">Community with 10 agents.</code></pre><h2 id="Accessing-and-manipulating-a-Community"><a class="docs-heading-anchor" href="#Accessing-and-manipulating-a-Community">Accessing and manipulating a Community</a><a id="Accessing-and-manipulating-a-Community-1"></a><a class="docs-heading-anchor-permalink" href="#Accessing-and-manipulating-a-Community" title="Permalink"></a></h2><p>You can access a community in two ways:</p><ul><li>Property: <code>com.parameter</code></li><li>Index: <code>com[:parameter]</code></li></ul><pre><code class="language-julia">println(com.x)</code></pre><pre><code class="language-none">[1.0, 2.0, 3.0, 4.0, 5.0, 6.0, 7.0, 8.0, 9.0, 10.0]</code></pre><pre><code class="language-julia">println(com[:x])</code></pre><pre><code class="language-none">[1.0, 2.0, 3.0, 4.0, 5.0, 6.0, 7.0, 8.0, 9.0, 10.0]</code></pre><p>You can manipulate certain parameters in a community and assigning new values using the <code>=</code> operator.</p><p>It works both for assigning a new array.</p><pre><code class="language-julia">com.x = Vector(2:11.)
println(com.x)</code></pre><pre><code class="language-none">[2.0, 3.0, 4.0, 5.0, 6.0, 7.0, 8.0, 9.0, 10.0, 11.0]</code></pre><p>and broad casting:</p><pre><code class="language-julia">com.x = 10
println(com.x)</code></pre><pre><code class="language-none">[10.0, 10.0, 10.0, 10.0, 10.0, 10.0, 10.0, 10.0, 10.0, 10.0]</code></pre><blockquote><p><strong>NOTE Protected parameters</strong> You will not be able and modify later some of the parameters of the model such as <code>N</code>. This behavior is intended to not break the functionality of the program. For example:</p><blockquote><pre><code class="language-julia">com.N = 10</code></pre></blockquote><blockquote><pre><code class="language-julia">Parameter of community N is protected. If you really need to change it declare a new Community or use setfield! method (can be unstable).

Stacktrace:
 [1] setproperty!(com::Community, var::Symbol, v::Int64)
   @ CellBasedModels ~/Documents/CellBasedModels.jl/src/CommunityStructure/communityStructure.jl:370
 [2] top-level scope
   @ ~/Documents/CellBasedModels.jl/examples/Usage_Community.ipynb:1</code></pre></blockquote><p>If you really need to change you can always use the function <code>setfield!</code> at your own risk of breacking the code.</p></blockquote><blockquote><p><strong>WARNING Avoid broadcasting</strong> As you can see the assign operator has been defined in such a way that works both for assigning new arrays to the parameters and broadcasting. I do not advice to use the broadcasted operator <code>.=</code> as it may change the behavior of protedted parameters which may modify in unexpected ways the results of the simulations,</p></blockquote><h2 id="IO"><a class="docs-heading-anchor" href="#IO">IO</a><a id="IO-1"></a><a class="docs-heading-anchor-permalink" href="#IO" title="Permalink"></a></h2><p>When evolving the system, you will want to save instances of the community. Currently there are two ways of saving them:</p><h4 id="RAM"><a class="docs-heading-anchor" href="#RAM">RAM</a><a id="RAM-1"></a><a class="docs-heading-anchor-permalink" href="#RAM" title="Permalink"></a></h4><p>For saving a function in RAM we can invoke the function <code>saveRam!</code>. This will save an instance of the current state in <code>Community.pastTimes</code>.</p><pre><code class="language-julia">com.x = 10
saveRAM!(com)
com.x = 0.5
println(&quot;Current state of x: &quot;, com.x)</code></pre><pre><code class="language-none">Current state of x: [0.5, 0.5, 0.5, 0.5, 0.5, 0.5, 0.5, 0.5, 0.5, 0.5]</code></pre><p>You can check how many instances have been saved using the function <code>length</code> on the community.</p><pre><code class="language-julia">length(com)</code></pre><pre><code class="language-none">1</code></pre><p>And you can access any past community instance calling by index of the position.</p><pre><code class="language-julia">println(&quot;Past community x: &quot;, com[1].x)
println(&quot;Current community x: &quot;, com.x)</code></pre><pre><code class="language-none">Past community x: [10.0, 10.0, 10.0, 10.0, 10.0, 10.0, 10.0, 10.0, 10.0, 10.0]
Current community x: [0.5, 0.5, 0.5, 0.5, 0.5, 0.5, 0.5, 0.5, 0.5, 0.5]</code></pre><h4 id="JLD2"><a class="docs-heading-anchor" href="#JLD2">JLD2</a><a id="JLD2-1"></a><a class="docs-heading-anchor-permalink" href="#JLD2" title="Permalink"></a></h4><p>We can also save the instances in JLD2 format, a format based in H5MD saving files system that is compatible and readable from many other programming languages and platforms.</p><pre><code class="language-julia">saveJLD2(&quot;test.jld2&quot;,com)</code></pre><p>And you can always call back the model from a JLD2 file.</p><pre><code class="language-julia">com  = loadJLD2(&quot;test.jld2&quot;)
com.loaded</code></pre><pre><code class="language-none">false</code></pre><p>This file will have all Community instances from the file loaded in <code>Community.pastTimes</code> and a copy of the last saved time in the current community itself.</p><h1 id="Evolving-the-community"><a class="docs-heading-anchor" href="#Evolving-the-community">Evolving the community</a><a id="Evolving-the-community-1"></a><a class="docs-heading-anchor-permalink" href="#Evolving-the-community" title="Permalink"></a></h1><p>Once we have defined a model and constructed an initial community, we can evolve it by the rules of the model.</p><p>In the following schema we describe the basic collection of functions provided by the package to evolve the model, where some functions perform automatically all the step that are described on the right.</p><p>&lt;table&gt;     &lt;thead&gt;         &lt;th colspan=3&gt; Functions &lt;/th&gt;         &lt;th&gt; Description &lt;/th&gt;     &lt;/thead&gt;     &lt;tbody&gt;         &lt;tr&gt;             &lt;td rowspan=12&gt;evolve!&lt;/td&gt;             &lt;td colspan=2&gt;loadToPlatform!&lt;/td&gt;             &lt;td&gt;Function that loads the community information to the appropiate platform (CPU or GPU) for being able to evolve it. In CPU in fact nothing happens.&lt;/td&gt;         &lt;/tr&gt;         &lt;tr&gt;             &lt;td rowspan=9&gt;step!&lt;/td&gt;         &lt;/tr&gt;         &lt;tr&gt;             &lt;td&gt;agentStepDE!&lt;/td&gt;             &lt;td&gt;Performs the agent DE step.&lt;/td&gt;         &lt;/tr&gt;         &lt;tr&gt;             &lt;td&gt;agentStepRule!&lt;/td&gt;             &lt;td&gt;Performs the agent rule step.&lt;/td&gt;         &lt;/tr&gt;         &lt;tr&gt;             &lt;td&gt;mediumStepDE!&lt;/td&gt;             &lt;td&gt;Performs the medium DE step.&lt;/td&gt;         &lt;/tr&gt;         &lt;tr&gt;             &lt;td&gt;mediumStepRule!&lt;/td&gt;             &lt;td&gt;Performs the medium rule step.&lt;/td&gt;         &lt;/tr&gt;         &lt;tr&gt;             &lt;td&gt;modelStepDE!&lt;/td&gt;             &lt;td&gt;Performs the model DE step.&lt;/td&gt;         &lt;/tr&gt;         &lt;tr&gt;             &lt;td&gt;modelStepRule!&lt;/td&gt;             &lt;td&gt;Performs the model rule step.&lt;/td&gt;         &lt;/tr&gt;         &lt;tr&gt;             &lt;td&gt;update!&lt;/td&gt;             &lt;td&gt;Saves all the updated parameters of the community as the present time. Until this function is called all the steps are stored as the future time and the step has not taken place yet!&lt;/td&gt;         &lt;/tr&gt;         &lt;tr&gt;             &lt;td&gt;computeNeighbors!&lt;/td&gt;             &lt;td&gt;Uptdates de neighborhoods of the agents if necessary.&lt;/td&gt;         &lt;/tr&gt;         &lt;tr&gt;             &lt;td colspan=2&gt;saveRAM!/saveJLD2!&lt;/td&gt;             &lt;td&gt;Save the current instance of the community.&lt;/td&gt;         &lt;/tr&gt;         &lt;tr&gt;             &lt;td colspan=2&gt;bringFromPlatform!&lt;/td&gt;             &lt;td&gt;Brings back the community to RAM again.&lt;/td&gt;         &lt;/tr&gt;     &lt;/tbody&gt; &lt;/table&gt;</p><p>Depending on the control that the user wants to have on the call of the evolution functions, they can decide to use one of the three column schemas proposed above.</p><p>So simple evolutions in which we want only to evolve the model after initialization for certain time and save steps at fixed time points, the package already includes the function <code>evolve!</code>.</p><pre><code class="language-julia">evolve!(com,steps=100,saveEach=10)</code></pre><p>And we can see that our model has now ten more saved points.</p><pre><code class="language-julia">length(com)</code></pre><pre><code class="language-none">10</code></pre><h4 id="Customizing-your-evolution-function"><a class="docs-heading-anchor" href="#Customizing-your-evolution-function">Customizing your evolution function</a><a id="Customizing-your-evolution-function-1"></a><a class="docs-heading-anchor-permalink" href="#Customizing-your-evolution-function" title="Permalink"></a></h4><p>If you want a more fancy stepping function, you can use more atomic functions to have more control of the stepping process.</p><p><strong>Example</strong> Imagine that we want to save an instance only after some agent <code>x</code> has surpassed a a certain limit.</p><pre><code class="language-julia">function evolveCustom!(com,steps)
    loadToPlatform!(com) #Always necessary to load the parameters to the platform
    for i in 1:steps
        agentStepDE!(com) #This model only has an SDE that is updated with this function. 
        update!(com) #Always necessary to update the parameters at the end of all the steps.
        if any(com.x .&gt; 5.0)
            saveRAM!(com)
        end
    end
    bringFromPlatform!(com) #Always necessary to bring the data back to RAM after evolution lo unlock the agent.
end;</code></pre><pre><code class="language-julia">com = com[1] #Get initial instance of the agent above defined

evolveCustom!(com,10)</code></pre></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="Usage_Agent.html">« Defining an ABM model</a><a class="docs-footer-nextpage" href="Usage_Fitting.html">Model Fitting »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> on <span class="colophon-date" title="Tuesday 2 July 2024 11:47">Tuesday 2 July 2024</span>. Using Julia version 1.6.7.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
